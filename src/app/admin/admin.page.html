<ion-header [translucent]="true">
  <ion-toolbar color="warning">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>
      Panel de Administrador 
      <ion-icon name="hammer-outline"></ion-icon>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <ion-card class="ion-margin-top ion-text-center" color="light">
    <ion-card-header>
      <ion-card-title>GestiÃ³n de Usuarios</ion-card-title>
      <ion-card-subtitle>Lista de todas las cuentas registradas en el sistema.</ion-card-subtitle>
    </ion-card-header>
  </ion-card>

  <ion-list [inset]="true" class="ion-margin-top">
    <ion-list-header>
      <!-- FIX 1: Se elimina '()' para acceder a la longitud de la propiedad 'users' (array) -->
      <ion-label>Cuentas ({{ users.length }})</ion-label>
      <ion-button (click)="loadUsers()" fill="clear" color="primary">
          <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
      </ion-button>
    </ion-list-header>
    
    <!-- FIX 2: Se elimina '()' para acceder a la propiedad booleana 'isLoading' -->
    @if (isLoading) {
      <ion-item lines="none">
        <ion-spinner name="crescent" slot="start"></ion-spinner>
        <ion-label class="ion-padding-start">Cargando usuarios...</ion-label>
      </ion-item>
    } @else if (users.length === 0) {
      <ion-item lines="none">
        <ion-label class="ion-text-center ion-padding">
          <p>ğŸ˜¢ No se encontraron usuarios en la base de datos.</p>
        </ion-label>
      </ion-item>
    }

    <!-- FIX 3: Se elimina '()' para iterar sobre la propiedad 'users' (array) -->
    @for (user of users; track user._id) {
      <ion-item>
        <ion-icon slot="start" [name]="user.isAdmin ? 'shield-checkmark-outline' : 'person-outline'" [color]="user.isAdmin ? 'danger' : 'medium'"></ion-icon>

        <ion-label class="ion-text-wrap">
          <h2>{{ user.username }}</h2>
          <p>ID: {{ user._id }}</p>
          <p>Registrado: {{ user.createdAt | date: 'shortDate' }}</p>
        </ion-label>
        
        <ion-chip slot="end" [color]="user.isAdmin ? 'danger' : 'success'">
            {{ user.isAdmin ? 'ADMIN' : 'USER' }}
        </ion-chip>
        
        <!-- LÃ­nea 50: Llamada al mÃ©todo deleteUser con el ID como string -->
        @if (!user.isAdmin) {
            <ion-button slot="end" fill="clear" color="danger" (click)="deleteUser(user._id)">
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
            </ion-button>
        } @else {
             <!-- No se permite eliminar la cuenta de administrador -->
            <ion-button slot="end" fill="clear" color="medium" [disabled]="true">
                <ion-icon slot="icon-only" name="lock-closed-outline"></ion-icon>
            </ion-button>
        }
      </ion-item>
    }
  </ion-list>
  
  <p class="ion-text-center ion-margin-top ion-padding-bottom">
    <small class="ion-color-medium">El administrador no puede ser eliminado desde este panel.</small>
  </p>

</ion-content>