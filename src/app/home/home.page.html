<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Lista de Tareas</ion-title>

    <!-- ğŸš€ BOTÃ“N DE ADMINISTRACIÃ“N: Visible solo para administradores -->
    <ion-buttons slot="primary" *ngIf="isAdminUser">
      <ion-button (click)="goToAdmin()">
        <ion-icon name="shield-half-outline" slot="icon-only" color="primary"></ion-icon>
      </ion-button>
    </ion-buttons>

    <!-- BOTÃ“N DE CERRAR SESIÃ“N -->
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon name="log-out-outline" slot="icon-only" color="danger"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <!-- FORMULARIO DE AÃ‘ADIR TAREA -->
  <ion-card class="ion-margin-bottom">
    <ion-card-header>
      <ion-card-title>Nueva Tarea</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-input label="TÃ­tulo" labelPlacement="stacked" [(ngModel)]="newTaskTitle" required placeholder="Ej. Comprar pan"></ion-input>
      </ion-item>
      <ion-item lines="none">
        <ion-textarea label="DescripciÃ³n (Opcional)" labelPlacement="stacked" [(ngModel)]="newTaskDescription" rows="3" placeholder="Detalles de la tarea..."></ion-textarea>
      </ion-item>
      <ion-button expand="block" class="ion-margin-top" (click)="addTask()" [disabled]="!newTaskTitle">
        AÃ±adir Tarea
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- LISTA DE TAREAS -->
  <ion-list *ngIf="tasks.length > 0; else noTasks">
    <ion-item *ngFor="let task of tasks" lines="full" class="task-item" [class.completed]="task.completed">
      
      <!-- CHECKBOX (Inicio del Item) -->
      <ion-checkbox slot="start" [checked]="task.completed" (ionChange)="toggleTaskCompletion(task)">
      </ion-checkbox>

      <!-- ETIQUETAS DE TEXTO (Centro del Item) -->
      <ion-label>
        <h2>{{ task.title }}</h2>
        
        <!-- Fecha de CreaciÃ³n -->
        <p class="date-text">
          Creada: {{ task.createdAt | date: 'shortDate' }}
        </p>
        
        <!-- ESTADO COMPLETADO Y FECHA -->
        <p [class.completed-date]="task.completed" [class.pending-status]="!task.completed">
          Completada: 
          <span *ngIf="task.completedAt; else pendingStatus">
             {{ task.completedAt | date: 'shortDate' }}
          </span>
          <ng-template #pendingStatus>
             No
          </ng-template>
        </p>

        <!-- DescripciÃ³n (si existe) -->
        <p class="description-text">{{ task.description }}</p>

      </ion-label>

      <!-- BOTÃ“N DE ELIMINAR (Final del Item) -->
      <ion-button slot="end" fill="clear" color="danger" (click)="deleteTask(task)">
        <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-item>
  </ion-list>

  <!-- TEMPLATE: Si no hay tareas -->
  <ng-template #noTasks>
    <div class="ion-text-center ion-padding-top">
      <ion-text color="medium">
        <ion-icon name="happy-outline" size="large"></ion-icon>
        <p>Â¡No tienes tareas pendientes!</p>
      </ion-text>
    </div>
  </ng-template>

</ion-content>